<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Test Page - Depression Insight</title>
    <link href="{{ url_for('static', filename='css/styles.css') }}" rel="stylesheet">
</head>
<body>
    <header>
        <div class="logo">
            <img src="{{ url_for('static', filename='img/insightify.JPG') }}" alt="Insightify Logo">
        </div>
        <div class="title">
            <h1>Insightify</h1>
        </div>
        <nav>
            <ul>
                <li><a href="{{ url_for('user.index') }}">Home</a></li>
                <li><a href="{{ url_for('user.test') }}">Take the Test</a></li>
                <li><a href="{{ url_for('user.about') }}">About</a></li>
                <li><a href="{{ url_for('user.contact') }}">Contact</a></li>
            </ul>
        </nav>
        <div class="logout">
            <button onclick="logout()">Logout</button>
        </div>
    </header>

    <main>
        <div class="test">
            <h2>Depression Self-Assessment Test</h2>
            <br action="#">
                

                <form method="POST" action="{{ url_for('user.submit_test') }}">
                    <p>Please select the option that best describes how you've been feeling in the past two weeks:</p>
                
                    {% for question in questions %}
                        <label>{{ loop.index }}. {{ question.question_text }}</label><br>
                        {% for option in options[question.id] %}
                            <input type="radio" name="q{{ question.id }}" value="{{ option.value }}"> {{ option.option_text }}<br>
                        {% endfor %}
                        <br>
                    {% endfor %}
                
                    <button type="submit">Submit</button>
                </form>
                    </div>
    </main>
    

    <footer>
        <p>&copy; 2025 Insightify. All rights reserved.</p>
        <p><a href="{{ url_for('user.privacy') }}">Privacy Policy</a> | <a href="{{ url_for('user.terms') }}">Terms & Conditions</a></p>
    </footer>

    <script>
        function submitTest() {
            // Get all selected answers
            const form = document.getElementById('testForm');
            const formData = new FormData(form);
            
            let totalScore = 0;
            
            // Calculate the total score
            formData.forEach((value, key) => {
                totalScore += parseInt(value); // Add up the values
            });

            // Send the total score to the backend for prediction
            fetch('/predict', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ total_score: totalScore })
            })
            .then(response => response.json())
            .then(data => {
                // Display the prediction result
                const resultDiv = document.getElementById('predictionResult');
                resultDiv.innerHTML = `<p>Prediction: ${data.depression_level}</p>`;
            })
            .catch(error => {
                console.error('Error:', error);
                alert("Error occurred while making prediction.");
            });
        }
    </script>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>
